<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Hardin â€“ Åehir AnÄ± AlbÃ¼mÃ¼n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #f6f4f1;
      --card-bg: #ffffff;
      --text: #2d3029;
      --accent: #745e4d;
      --accent-soft: #e3dfd8;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ÃœST BAR */
    .topbar {
      width: 100%;
      padding: 10px 16px;
      background: #2d3029;
      color: #f6f4f1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .topbar-title {
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    .page {
      max-width: 960px;
      margin: 18px auto 32px;
      padding: 0 14px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 18px 16px 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.04);
    }

    .card-with-bg {
      position: relative;
      overflow: hidden;
    }

    .card-with-bg .card-bg {
      position: absolute;
      inset: 0;
      /* ğŸ”½ Buradaki URL'yi kendi ÅŸehir fotoÄŸrafÄ±nla deÄŸiÅŸtirebilirsin */
      background-image: url("https://images.pexels.com/photos/417074/pexels-photo-417074.jpeg?auto=compress&cs=tinysrgb&w=1200");
      background-size: cover;
      background-position: center;
      opacity: 0.3;
      filter: blur(2px);
      transform: scale(1.05);
    }

    .card-inner {
      position: relative;
      backdrop-filter: blur(1px);
    }

    h1 {
      margin: 0 0 6px;
      font-size: 1.4rem;
    }

    .subtitle {
      font-size: 0.9rem;
      margin: 0 0 10px;
      line-height: 1.45;
    }

    .note {
      font-size: 0.78rem;
      color: #7a7a7a;
      margin-bottom: 14px;
    }

    .btn-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    .btn {
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease;
      border: none;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    }

    .btn-secondary {
      background: var(--accent-soft);
      color: var(--text);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text);
      padding-left: 0;
      padding-right: 0;
      box-shadow: none;
      font-size: 0.86rem;
    }

    .btn-primary:active,
    .btn-ghost:active,
    .btn-secondary:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.16);
    }

    .btn-emoji { font-size: 1rem; }

    .city-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.7);
      font-size: 0.78rem;
      margin-bottom: 10px;
    }

    .city-tag span { opacity: 0.85; }

    .home-counter {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #444;
    }

    .home-thumbs {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      flex-wrap: nowrap;
    }

    .home-thumb {
      width: 64px;
      height: 64px;
      border-radius: 10px;
      overflow: hidden;
      background: #ddd;
      flex-shrink: 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    .home-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .social-row {
      margin-top: 14px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .social-btn {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      text-decoration: none;
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.07);
    }

    .social-btn span { white-space: nowrap; }

    .info-section {
      margin-top: 16px;
      font-size: 0.84rem;
    }

    .acc-item {
      border-top: 1px solid rgba(0,0,0,0.06);
      padding: 8px 0;
    }

    .acc-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .acc-header span {
      font-size: 1rem;
      color: #777;
    }

    .acc-content {
      display: none;
      margin-top: 6px;
      color: #555;
    }

    .acc-item.open .acc-content {
      display: block;
    }

    .acc-item.open .acc-header span {
      transform: rotate(45deg);
    }

    .counter {
      font-size: 0.8rem;
      color: #777;
      margin-top: 6px;
    }

    #fileInput { display: none; }

    /* ALBÃœM GÃ–RÃœNÃœMÃœ */
    #photos {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .photo-card {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .photo {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      background: #d9d9d9;
      aspect-ratio: 3 / 4;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    .photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .delete {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0,0,0,0.6);
      width: 26px;
      height: 26px;
      border-radius: 999px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      backdrop-filter: blur(3px);
    }

    .note-input {
      font-size: 0.78rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      outline: none;
      background: #f7f4f0;
      color: #444;
      width: 100%;
    }

    .note-input::placeholder { color: #aaa; }

    .empty {
      margin-top: 10px;
      color: #777;
      font-size: 0.86rem;
    }

    .view { display: none; }
    .view.active { display: block; }

    /* SLIDESHOW OVERLAY */
    .slideshow-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      overflow: hidden;
    }

    .slideshow-overlay.active {
      display: flex;
    }

    .slide-top {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 14px;
      font-size: 0.9rem;
      z-index: 2;
    }

    .slide-top-center {
      flex: 1;
      text-align: center;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .slide-btn {
      background: rgba(0,0,0,0.5);
      border-radius: 999px;
      padding: 6px 10px;
      border: none;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .slide-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border: none;
      color: #fff;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 2;
    }

    .slide-nav.prev { left: 10px; }
    .slide-nav.next { right: 10px; }

    .slide-counter {
      font-size: 0.85rem;
      opacity: 0.8;
    }

    .slide-img-wrap {
      max-width: 100%;
      max-height: calc(100vh - 140px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }

    .slide-img-wrap img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .slide-note {
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.55);
      padding: 6px 12px;
      border-radius: 999px;
      max-width: 90%;
      font-size: 0.82rem;
      text-align: center;
      opacity: 0.95;
      color: #fff;
      word-wrap: break-word;
    }

    .slide-note:empty {
      display: none;
    }

    .slide-album-date {
      white-space: nowrap;
    }

    @media (min-width: 768px) {
      .card {
        padding: 22px 22px 24px;
      }
      h1 {
        font-size: 1.6rem;
      }
      #photos {
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="topbar-title">HARDÄ°N â€¢ AKILLI ANI MAGNETÄ°</div>
  </div>

  <div class="page">

    <!-- 1) ANA SAYFA -->
    <section id="view-home" class="view active">
      <div class="card card-with-bg">
        <div class="card-bg"></div>
        <div class="card-inner">
          <div class="city-tag">
            <strong>Åehir:</strong> <span>Deneme Åehri</span>
          </div>

          <h1>Åehir AnÄ± AlbÃ¼mÃ¼n</h1>
          <p class="subtitle">
            Bu magneti okuttuÄŸunda, bu sayfa senin o ÅŸehre ait
            <strong>kiÅŸisel anÄ± albÃ¼mÃ¼n</strong> olur. FotoÄŸraflar sadece burada,
            bu cihazda kalÄ±r.
          </p>
          <p class="note">
            AÅŸaÄŸÄ±dan albÃ¼mÃ¼nÃ¼ oluÅŸturabilir, yeni fotoÄŸraf ekleyebilir veya anÄ±larÄ±nÄ±
            tam ekran slayt gÃ¶sterisiyle izleyebilirsin.
          </p>

          <div class="btn-row">
            <!-- AlbÃ¼m OluÅŸtur: sadece sayfa geÃ§iÅŸi yapÄ±yor -->
            <button class="btn btn-primary" type="button" onclick="setView('manage')">
              <span class="btn-emoji">ğŸ“¸</span>
              <span>AlbÃ¼m OluÅŸtur</span>
            </button>

            <button id="playButton" class="btn btn-secondary" type="button" onclick="openSlideshow(0)">
              ğŸï¸ AnÄ±larÄ± CanlandÄ±r
            </button>
          </div>

          <!-- Ana sayfa sayaÃ§ + son 5 foto Ã¶nizleme -->
          <div id="homeCounter" class="home-counter"></div>
          <div id="homeThumbs" class="home-thumbs"></div>

          <!-- Sosyal ikonlar -->
          <div class="social-row">
            <a class="social-btn" href="https://instagram.com" target="_blank" rel="noopener noreferrer">
              ğŸ“· <span>Instagram</span>
            </a>
            <a class="social-btn" href="https://wa.me/90XXXXXXXXXX" target="_blank" rel="noopener noreferrer">
              ğŸ’¬ <span>WhatsApp</span>
            </a>
            <a class="social-btn" href="https://trendyol.com" target="_blank" rel="noopener noreferrer">
              ğŸ›’ <span>MaÄŸaza</span>
            </a>
          </div>

          <!-- HakkÄ±nda - SSS - Åikayet/Talep -->
          <div class="info-section">
            <div id="accAbout" class="acc-item">
              <div class="acc-header" onclick="toggleAccordion('accAbout')">
                <span>HakkÄ±nda</span>
                <span>+</span>
              </div>
              <div class="acc-content">
                Hardin akÄ±llÄ± anÄ± magnetleri, gezdiÄŸin ÅŸehirlerin fotoÄŸraflarÄ±nÄ±
                kendi telefonunda saklamanÄ± ve dilediÄŸinde slayt gÃ¶sterisi gibi
                izleyebilmeni saÄŸlar. FotoÄŸraflarÄ±n internet yerine yalnÄ±zca
                cihazÄ±nda tutulur.
              </div>
            </div>

            <div id="accFaq" class="acc-item">
              <div class="acc-header" onclick="toggleAccordion('accFaq')">
                <span>SÄ±k Sorulan Sorular</span>
                <span>+</span>
              </div>
              <div class="acc-content">
                <strong>FotoÄŸraflarÄ±m internete yÃ¼kleniyor mu?</strong><br>
                HayÄ±r. TÃ¼m fotoÄŸraflar, sadece bu cihazÄ±n hafÄ±zasÄ±nda saklanÄ±r.<br><br>

                <strong>AlbÃ¼mÃ¼ baÅŸka telefondan gÃ¶rebilir miyim?</strong><br>
                AynÄ± magneti baÅŸka bir telefondan okuttuÄŸunda, o telefonda yeni bir
                albÃ¼m oluÅŸturman gerekir. AlbÃ¼mler cihaz bazlÄ±dÄ±r.<br><br>

                <strong>FotoÄŸraf sayÄ±sÄ±nÄ±n bir sÄ±nÄ±rÄ± var mÄ±?</strong><br>
                Telefonunun tarayÄ±cÄ± hafÄ±zasÄ±na baÄŸlÄ± olarak pratikte bir sÄ±nÄ±r vardÄ±r.
                SÄ±nÄ±r dolduÄŸunda uygulama seni uyarÄ±r ve yeni fotoÄŸraf iÃ§in bazÄ±larÄ±nÄ±
                silmeni ister.
              </div>
            </div>

            <div id="accComplaint" class="acc-item">
              <div class="acc-header" onclick="toggleAccordion('accComplaint')">
                <span>Åikayet & Talep</span>
                <span>+</span>
              </div>
              <div class="acc-content">
                <p style="margin-top:0;">
                  GÃ¶rÃ¼ÅŸ, ÅŸikayet veya Ã¶nerini aÅŸaÄŸÄ±ya yazÄ±p â€œMail GÃ¶nderâ€e tÄ±klayarak
                  bize e-posta gÃ¶nderebilirsin.
                </p>
                <textarea id="complaintText" rows="3" style="width:100%; font-size:0.8rem; padding:6px; border-radius:8px; border:1px solid rgba(0,0,0,0.15);"></textarea>
                <button class="btn btn-secondary" type="button" style="margin-top:6px;" onclick="sendComplaint()">
                  âœ‰ï¸ Mail GÃ¶nder
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- 2) ALBÃœMÃœ YÃ–NET -->
    <section id="view-manage" class="view">
      <div class="card">
        <button class="btn btn-ghost" type="button" onclick="setView('home')">
          â† Ana sayfaya dÃ¶n
        </button>

        <h1>AlbÃ¼mÃ¼ YÃ¶net</h1>
        <p class="subtitle">
          FotoÄŸraf ekleyebilir, not yazabilir, tarihi belirleyebilir ve albÃ¼mÃ¼nÃ¼
          dilediÄŸin zaman gÃ¼ncelleyebilirsin.
        </p>

        <div class="btn-row">
          <label class="btn btn-primary" for="fileInput">
            <span class="btn-emoji">ğŸ“¸</span>
            <span>FotoÄŸraf Ekle</span>
          </label>

          <button class="btn btn-secondary" type="button" onclick="clearAllPhotos()">
            ğŸ§¹ AlbÃ¼mÃ¼ Temizle
          </button>

          <button class="btn btn-secondary" type="button" onclick="setAlbumDate()">
            ğŸ“… Tarih Belirle
          </button>

          <button class="btn btn-secondary" type="button" onclick="selectMusic()">
            ğŸµ Fon MÃ¼ziÄŸi SeÃ§
          </button>
        </div>

        <div id="counter" class="counter"></div>
        <div id="musicInfo" class="counter"></div>

        <input id="fileInput" type="file" accept="image/*" multiple>

        <div id="photos"></div>
        <div id="emptyMsg" class="empty"></div>
      </div>
    </section>

  </div>

  <!-- 3) TAM EKRAN SLAYT GÃ–STERÄ°SÄ° -->
  <div id="slideshow" class="slideshow-overlay">
    <div class="slide-top">
      <button class="slide-btn" type="button" onclick="closeSlideshow()">
        âœ• Kapat
      </button>

      <div class="slide-top-center">
        <span id="slideAlbumDate" class="slide-album-date"></span>
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <button id="playPauseBtn" class="slide-btn" type="button" onclick="togglePlay()">
          â–¶ï¸ Oynat
        </button>
        <div class="slide-counter" id="slideCounter"></div>
      </div>
    </div>

    <button class="slide-nav prev" type="button" onclick="prevSlide()">â®</button>
    <div class="slide-img-wrap">
      <img id="slideImage" src="" alt="AnÄ± fotoÄŸrafÄ±">
    </div>
    <button class="slide-nav next" type="button" onclick="nextSlide()">â¯</button>

    <div id="slideNote" class="slide-note"></div>
  </div>

  <!-- Arka plan fon mÃ¼ziÄŸi -->
  <audio id="bgAudio" loop></audio>

  <script>
    const CURRENT_ID = "deneme";
    const ALBUM_KEY = "hardin_album_" + CURRENT_ID;
    const META_KEY = ALBUM_KEY + "_meta";
    const MAX_PHOTOS = 20;

    const MUSIC_OPTIONS = {
      none: { label: "Yok", src: null },
      track1: { label: "Piyano", src: "denme/music1.mp3" }, // buradaki dosyalarÄ± sen ekleyeceksin
      track2: { label: "Lo-fi",  src: "denme/music2.mp3" }
    };

    let photos = [];
    let albumMeta = { date: null, music: "none" };

    let currentSlide = 0;
    let slideTimer = null;
    let isPlaying = false;

    let touchStartX = 0;
    let touchEndX = 0;

    // Eski veri tipini (string array) destekle
    try {
      const stored = JSON.parse(localStorage.getItem(ALBUM_KEY) || "[]");
      if (Array.isArray(stored)) {
        if (stored.length && typeof stored[0] === "string") {
          photos = stored.map(src => ({ src, note: "" }));
          localStorage.setItem(ALBUM_KEY, JSON.stringify(photos));
        } else {
          photos = stored;
        }
      }
    } catch (e) {
      photos = [];
    }

    // Meta yÃ¼kle
    try {
      const m = JSON.parse(localStorage.getItem(META_KEY) || "null");
      if (m && typeof m === "object") {
        albumMeta = { ...albumMeta, ...m };
      }
    } catch(e) {}

    function savePhotos() {
      try {
        localStorage.setItem(ALBUM_KEY, JSON.stringify(photos));
        return true;
      } catch (e) {
        alert("AlbÃ¼m telefon hafÄ±zasÄ±nda izin verilen sÄ±nÄ±ra ulaÅŸtÄ±. Yeni fotoÄŸraf eklemek iÃ§in Ã¶nce bazÄ±larÄ±nÄ± silmen gerekiyor.");
        console.error(e);
        return false;
      }
    }

    function saveMeta() {
      try {
        localStorage.setItem(META_KEY, JSON.stringify(albumMeta));
      } catch (e) {
        console.error(e);
      }
    }

    // SayaÃ§lar + tarih + mÃ¼zik etiketi
    function updateCounters() {
      const manageCounter = document.getElementById("counter");
      const homeCounter = document.getElementById("homeCounter");
      const playButton = document.getElementById("playButton");
      const slideAlbumDate = document.getElementById("slideAlbumDate");
      const musicInfo = document.getElementById("musicInfo");

      let textMain = "";
      if (photos.length === 1) {
        textMain = "AlbÃ¼mÃ¼nde 1 fotoÄŸraf var";
      } else if (photos.length > 1) {
        textMain = "AlbÃ¼mÃ¼nde " + photos.length + " fotoÄŸraf var";
      } else {
        textMain = "HenÃ¼z fotoÄŸraf eklenmedi";
      }

      let datePart = albumMeta.date ? (" â€¢ Tarih: " + albumMeta.date) : "";

      if (manageCounter) {
        manageCounter.innerText = photos.length ? (textMain + datePart) : "";
      }
      if (homeCounter) {
        if (photos.length === 0) {
          homeCounter.innerText = "HenÃ¼z fotoÄŸraf eklenmedi. BaÅŸlamak iÃ§in aÅŸaÄŸÄ±dan AlbÃ¼m OluÅŸturâ€™a dokun.";
        } else {
          homeCounter.innerText = textMain + datePart;
        }
      }
      if (slideAlbumDate) {
        slideAlbumDate.innerText = albumMeta.date ? albumMeta.date : "";
      }

      if (playButton) {
        if (photos.length === 0) {
          playButton.disabled = true;
          playButton.style.opacity = "0.4";
        } else {
          playButton.disabled = false;
          playButton.style.opacity = "1";
        }
      }

      if (musicInfo) {
        const opt = MUSIC_OPTIONS[albumMeta.music] || MUSIC_OPTIONS.none;
        musicInfo.innerText = "Fon mÃ¼ziÄŸi: " + opt.label;
      }
    }

    // Ana sayfadaki son 5 fotoÄŸraf Ã¶nizlemesi
    function updateHomeThumbs() {
      const container = document.getElementById("homeThumbs");
      if (!container) return;

      container.innerHTML = "";
      if (!photos.length) return;

      const start = Math.max(photos.length - 5, 0);
      for (let i = start; i < photos.length; i++) {
        const div = document.createElement("div");
        div.className = "home-thumb";

        const img = document.createElement("img");
        img.src = photos[i].src;
        img.onclick = () => openSlideshow(i);

        div.appendChild(img);
        container.appendChild(div);
      }
    }

    function render() {
      const container = document.getElementById("photos");
      const empty = document.getElementById("emptyMsg");
      if (!container || !empty) return;

      container.innerHTML = "";

      if (photos.length === 0) {
        empty.innerText = "HenÃ¼z fotoÄŸraf eklenmedi. BaÅŸlamak iÃ§in yukarÄ±daki butona dokun.";
      } else {
        empty.innerText = "";
      }

      photos.forEach((photo, index) => {
        const card = document.createElement("div");
        card.className = "photo-card";

        const div = document.createElement("div");
        div.className = "photo";

        const img = document.createElement("img");
        img.src = photo.src;
        img.onclick = () => openSlideshow(index);

        const del = document.createElement("div");
        del.className = "delete";
        del.innerText = "Ã—";
        del.onclick = (e) => {
          e.stopPropagation();
          photos.splice(index, 1);
          savePhotos();
          render();
        };

        div.appendChild(img);
        div.appendChild(del);

        const noteInput = document.createElement("input");
        noteInput.className = "note-input";
        noteInput.type = "text";
        noteInput.placeholder = "Bu fotoÄŸraf iÃ§in kÃ¼Ã§Ã¼k bir not ekle...";
        noteInput.value = photo.note || "";
        noteInput.oninput = (e) => {
          photos[index].note = e.target.value || "";
          savePhotos();
          updateHomeThumbs();
          const overlay = document.getElementById("slideshow");
          if (overlay && overlay.classList.contains("active") && index === currentSlide) {
            updateSlideImage();
          }
        };

        card.appendChild(div);
        card.appendChild(noteInput);
        container.appendChild(card);
      });

      updateCounters();
      updateHomeThumbs();
    }

    function setView(view) {
      const home = document.getElementById("view-home");
      const manage = document.getElementById("view-manage");
      if (!home || !manage) return;

      if (view === "home") {
        home.classList.add("active");
        manage.classList.remove("active");
      } else {
        home.classList.remove("active");
        manage.classList.add("active");
      }
    }

    // FotoÄŸrafÄ± kÃ¼Ã§Ã¼ltÃ¼p ekle
    function addFileCompressed(file) {
      if (photos.length >= MAX_PHOTOS) {
        alert("Bu albÃ¼m en fazla " + MAX_PHOTOS + " fotoÄŸraf saklayabilir. Yeni fotoÄŸraf eklemek iÃ§in Ã¶nce bazÄ±larÄ±nÄ± sil.");
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => {
          const maxSize = 800; // daha agresif kÃ¼Ã§Ã¼ltme
          let w = img.width;
          let h = img.height;

          const scale = Math.min(maxSize / w, maxSize / h, 1);
          w = Math.round(w * scale);
          h = Math.round(h * scale);

          const canvas = document.createElement("canvas");
          canvas.width = w;
          canvas.height = h;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, w, h);

          const dataUrl = canvas.toDataURL("image/jpeg", 0.6);

          photos.push({ src: dataUrl, note: "" });
          if (!savePhotos()) {
            photos.pop();
          }
          render();
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    }

    const fileInput = document.getElementById("fileInput");
    if (fileInput) {
      fileInput.addEventListener("change", function() {
        const files = Array.from(this.files);
        files.forEach(file => addFileCompressed(file));
        this.value = "";
      });
    }

    function clearAllPhotos() {
      if (!photos.length) return;
      const ok = confirm("TÃ¼m fotoÄŸraflarÄ± silmek istediÄŸinden emin misin?");
      if (!ok) return;
      photos = [];
      savePhotos();
      render();
    }

    function formatDate(d) {
      const day = String(d.getDate()).padStart(2, "0");
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const year = d.getFullYear();
      return day + "." + month + "." + year;
    }

    function setAlbumDate() {
      const choice = prompt("AlbÃ¼m tarihi:\n1 - BugÃ¼n\n2 - DÃ¼n\n3 - Ã–zel tarih (GG.AA.YYYY)\nÄ°ptal iÃ§in boÅŸ bÄ±rak.");
      if (!choice) return;

      if (choice === "1") {
        albumMeta.date = formatDate(new Date());
      } else if (choice === "2") {
        const d = new Date();
        d.setDate(d.getDate() - 1);
        albumMeta.date = formatDate(d);
      } else if (choice === "3") {
        const custom = prompt("Tarihi GG.AA.YYYY formatÄ±nda gir (Ã¶r: 07.12.2025):");
        if (!custom) return;
        albumMeta.date = custom;
      } else {
        return;
      }
      saveMeta();
      updateCounters();
      updateSlideImage();
    }

    function selectMusic() {
      const choice = prompt("Fon mÃ¼ziÄŸi seÃ§:\n1 - Piyano\n2 - Lo-fi\n0 - MÃ¼zik yok");
      if (choice === null) return;

      if (choice === "1") {
        albumMeta.music = "track1";
      } else if (choice === "2") {
        albumMeta.music = "track2";
      } else if (choice === "0") {
        albumMeta.music = "none";
      } else {
        return;
      }
      saveMeta();
      updateCounters();
      if (isPlaying) {
        applyAudioSettings();
        playAudioSafe();
      }
    }

    function toggleAccordion(id) {
      const item = document.getElementById(id);
      if (!item) return;
      item.classList.toggle("open");
    }

    function sendComplaint() {
      const txtEl = document.getElementById("complaintText");
      if (!txtEl) return;
      const text = txtEl.value.trim();
      if (!text) {
        alert("LÃ¼tfen mesajÄ±nÄ± yaz.");
        return;
      }
      const subject = encodeURIComponent("Hardin Åikayet / Talep");
      const body = encodeURIComponent(text);
      // Buradaki mail adresini kendi mail adresinle deÄŸiÅŸtir
      const mailto = "mailto:ornek@mail.com?subject=" + subject + "&body=" + body;
      window.location.href = mailto;
    }

    // SLIDESHOW
    function openSlideshow(startIndex) {
      if (!photos.length) {
        alert("HenÃ¼z fotoÄŸraf eklenmedi. Ã–nce albÃ¼me birkaÃ§ fotoÄŸraf ekle.");
        return;
      }
      if (startIndex < 0 || startIndex >= photos.length) {
        startIndex = 0;
      }
      currentSlide = startIndex;
      const overlay = document.getElementById("slideshow");
      if (!overlay) return;
      overlay.classList.add("active");
      stopAutoPlay();
      updateSlideImage();
      updatePlayButton();
    }

    function closeSlideshow() {
      const overlay = document.getElementById("slideshow");
      if (!overlay) return;
      overlay.classList.remove("active");
      stopAutoPlay();
    }

    function updateSlideImage() {
      const img = document.getElementById("slideImage");
      const counter = document.getElementById("slideCounter");
      const noteEl = document.getElementById("slideNote");
      const dateEl = document.getElementById("slideAlbumDate");
      if (!img || !counter || photos.length === 0) return;
      currentSlide = (currentSlide + photos.length) % photos.length;
      img.src = photos[currentSlide].src;
      counter.innerText = (currentSlide + 1) + " / " + photos.length;
      if (noteEl) {
        noteEl.innerText = photos[currentSlide].note || "";
      }
      if (dateEl) {
        dateEl.innerText = albumMeta.date ? albumMeta.date : "";
      }
    }

    function nextSlide() {
      if (!photos.length) return;
      currentSlide = (currentSlide + 1) % photos.length;
      updateSlideImage();
    }

    function prevSlide() {
      if (!photos.length) return;
      currentSlide = (currentSlide - 1 + photos.length) % photos.length;
      updateSlideImage();
    }

    function applyAudioSettings() {
      const audio = document.getElementById("bgAudio");
      if (!audio) return;
      const opt = MUSIC_OPTIONS[albumMeta.music] || MUSIC_OPTIONS.none;
      if (!opt.src) {
        audio.pause();
        return;
      }
      const fullSrc = opt.src;
      if (audio.src !== fullSrc) {
        audio.src = fullSrc;
      }
    }

    function playAudioSafe() {
      const audio = document.getElementById("bgAudio");
      if (!audio) return;
      audio.play().catch(e => {
        console.error("Ses Ã§alÄ±namadÄ±:", e);
      });
    }

    function startAutoPlay() {
      if (isPlaying || !photos.length) return;
      isPlaying = true;
      slideTimer = setInterval(() => {
        nextSlide();
      }, 3000);
      applyAudioSettings();
      if (albumMeta.music !== "none") {
        playAudioSafe();
      }
      updatePlayButton();
    }

    function stopAutoPlay() {
      if (slideTimer) {
        clearInterval(slideTimer);
        slideTimer = null;
      }
      const audio = document.getElementById("bgAudio");
      if (audio) audio.pause();
      isPlaying = false;
      updatePlayButton();
    }

    function togglePlay() {
      if (!photos.length) return;
      if (isPlaying) {
        stopAutoPlay();
      } else {
        startAutoPlay();
      }
    }

    function updatePlayButton() {
      const btn = document.getElementById("playPauseBtn");
      if (!btn) return;
      btn.textContent = isPlaying ? "â¸ Durdur" : "â–¶ï¸ Oynat";
    }

    // Slideshow swipe (saÄŸa/sola kaydÄ±rma)
    const overlayEl = document.getElementById("slideshow");
    if (overlayEl) {
      overlayEl.addEventListener("touchstart", (e) => {
        if (!e.changedTouches || !e.changedTouches.length) return;
        touchStartX = e.changedTouches[0].clientX;
      }, { passive: true });

      overlayEl.addEventListener("touchend", (e) => {
        if (!e.changedTouches || !e.changedTouches.length) return;
        touchEndX = e.changedTouches[0].clientX;
        const dx = touchEndX - touchStartX;
        if (Math.abs(dx) > 40) {
          if (dx < 0) {
            nextSlide();
          } else {
            prevSlide();
          }
        }
      }, { passive: true });
    }

    // BaÅŸlangÄ±Ã§ta her ÅŸey
    render();
  </script>
</body>
</html>
